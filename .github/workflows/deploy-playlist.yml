name: Ultra-Fast Playlist Deploy

on:
  push:
    branches: [tyo878787]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    timeout-minutes: 2  # Batasi waktu maksimal

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4  # Versi terbaru

      # Download paralel dan proses sekaligus
      - name: Download & Process Playlists
        run: |
          mkdir -p docs
          # Download paralel dengan background processes
          curl -s -f "https://raw.githubusercontent.com/tyo878787/my-iptv-playlist/tyo878787/playlist1.m3u" -o /tmp/1.m3u &
          curl -s -f "https://cdn.jsdelivr.net/gh/iptv-org/iptv/index.m3u" -o /tmp/2.m3u &
          wait
          
          # Proses langsung tanpa file intermediate
          echo "#EXTM3U" > docs/Finalplay.m3u
          sed '1d' /tmp/1.m3u >> docs/Finalplay.m3u
          sed '1d' /tmp/2.m3u >> docs/Finalplay.m3u
          
          # Kompresi langsung
          gzip -9 docs/Finalplay.m3u

      - name: Setup Pages
        uses: actions/configure-pages@v3

      - name: Upload Artifact
        uses: actions/upload-pages-artifact@v2  # Versi terbaru
        with:
          path: docs/
          
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2  # Versi terbaru
        id: deployment

      - name: Show URL
        run: |
          echo "âœ… Deployed in ${{ steps.deployment.outputs.time }} seconds"
          echo "URL: https://${{ github.repository_owner }}.github.io/${{ github.repository }}/Finalplay.m3u.gz"
